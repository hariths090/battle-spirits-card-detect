<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
        crossorigin="anonymous"></script>
    <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script> -->
</head>

<style>
    #preview {
        max-width: 100%;
        max-height: calc(70vh - 150px);
        /* Adjust the height as needed, leaving space for other elements */
        height: auto;
        display: block;
        margin: 0 auto;
        /* Center the image */
    }
</style>


<body>
    <div class="container text-center">
        <div class="container mt-5">
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <input type="file" accept="image/*" capture="camera" class="form-control" id="cameraInput">
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-12">
                    <img id="preview" src="/images/source.jpg" alt="Preview" class="img-fluid rounded">
                </div>
            </div>

            <script>
                const cameraInput = document.getElementById('cameraInput');
                const preview = document.getElementById('preview');

                cameraInput.addEventListener('change', function (event) {
                    const file = event.target.files[0];
                    const reader = new FileReader();

                    reader.onload = function (e) {
                        preview.src = e.target.result;
                    };

                    reader.readAsDataURL(file);

                    const formData = new FormData();
                    formData.append('file', file);
                    formData.append('save', true);
                    for (const entry of formData.entries()) {
                        console.log(entry[0], entry[1]);
                    }
                    fetch('/upload/', {
                        method: 'POST',
                        body: formData
                    })
                        .then(response => response.json())
                        .then(data => {
                            console.log('Upload success:', data);
                            location.reload();
                        })
                        .catch(error => {
                            console.error('Upload error:', error);
                        });
                });
            </script>
        </div>

        <div class="row">
            {% for i in card %}
            {% set loop_index = loop.index %}
            {% if i.card[0].name != "no card" %}
            <div class="col-md-2 col-xs-12 p-2" style="float: left !important;">
                <img src="card/{{i.card[0].image}}" class="col-12 p-2" id="card{{ loop.index }}" data-bs-toggle="modal"
                    data-bs-target="#topten{{ loop.index }}">
                <p alt="gundam" style="width: 100%;overflow-x:hidden;white-space: nowrap;text-overflow: ellipsis;">
                    {{loop_index}} : {{i.card[0].name}}
                </p>
                <a id="data{{ loop.index }}" href="{{ 'https://battle-spirits.fandom.com/wiki/' + i.card[0].name }}"
                    class="btn btn-block p-2 m-2 bg-dark text-light" target="_blank">Card data</a>
            </div>

            <div class="modal fade" id="topten{{ loop.index }}" tabindex="-1"
                aria-labelledby="topten{{ loop.index }}Label" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div id="list{{ loop.index }}" class="carousel slide">
                            <div class="carousel-inner">
                                {% for j in i.card %}
                                <div class="carousel-item {{ 'active' if loop.index == 1 else '' }}">
                                    <div class="d-inline p-2 m-2 bg-white text-dark d-lg-block">{{ loop.index }} : {{
                                        j.name }}</div>
                                    <a href="{{ 'https://battle-spirits.fandom.com/wiki/' + j.name }}"
                                        class="text-center" target="_blank"
                                        onclick="document.getElementById('card{{loop_index}}').src = 'card/{{ j.image }}';document.getElementById('data{{loop_index}}').href = 'https\:\/\/battle-spirits.fandom.com\/wiki\/{{j.name}}';">
                                        <img class="rounded p-2" src="card/{{ j.image }}" style="height: 60vh;">
                                    </a>
                                </div>
                                {% endfor %}
                            </div>

                            <button class="carousel-control-prev" type="button" data-bs-target="#list{{ loop.index }}"
                                data-bs-slide="prev">
                                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="dark"
                                    class="bi bi-caret-left-fill" viewBox="0 0 16 16">
                                    <path
                                        d="m3.86 8.753 5.482 4.796c.646.566 1.658.106 1.658-.753V3.204a1 1 0 0 0-1.659-.753l-5.48 4.796a1 1 0 0 0 0 1.506z" />
                                </svg>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#list{{ loop.index }}"
                                data-bs-slide="next">
                                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="dark"
                                    class="bi bi-caret-right-fill" viewBox="0 0 16 16">
                                    <path
                                        d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
            {% endfor %}
        </div>
    </div>

</body>

</html>